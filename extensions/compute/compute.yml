---
# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
version: "1.0"

generics:
  - name: GenericUnit
    namespace: Compute
    description: A generic unit that can compute (e.g. server, vm ...).
    include_in_menu: false

  - name: HostVirtualMachine
    namespace: Virtualization
    description: A generic unut that can host VM
    include_in_menu: false
    relationships:
      - name: virtual_machines
        cardinality: many
        peer: VirtualizationVirtualMachine
        kind: Component
        optional: true

nodes:
  - name: PhysicalServer
    namespace: Compute
    description: A physical server with fixed resources and specific hardware characteristics.
    label: Physical Server
    icon: mdi:server
    inherit_from:
      - ComputeGenericUnit
      - DcimGenericDevice
      - DcimPhysicalDevice
      # If you don't want to have VM running directly on your physical server you can comment out the following line
      - VirtualizationHostVirtualMachine
    attributes:
      - name: status
        kind: Dropdown
        optional: false
        order_weight: 1100
        choices:
          - name: active
            label: Active
            description: Fully operational and currently in service.
            color: "#7fbf7f"
          - name: provisioning
            label: Provisioning
            description: In the process of being set up and configured.
            color: "#ffff7f"
          - name: maintenance
            label: Maintenance
            description: Undergoing routine maintenance or repairs.
            color: "#ffd27f"
          - name: drained
            label: Drained
            description: Temporarily taken out of service.
            color: "#bfbfbf"
  - name: VirtualMachine
    namespace: Virtualization
    description: A virtual machine hosted on a server or a cluster.
    label: Virtual Machine
    icon: carbon:virtual-machine
    inherit_from:
      - ComputeGenericUnit
      - DcimGenericDevice
    attributes:
      - name: role
        kind: Dropdown
        optional: true
        description: Role of the virtual machine.
        order_weight: 1400
        choices:
          - name: application
            color: "#7f7fff"
          - name: storage
            color: "#bf7fbf"
      - name: vcpu
        kind: Number
        optional: true
        order_weight: 1900
        description: Number of CPU cores assigned to the VM.
      - name: memory
        kind: Number
        optional: true
        order_weight: 1900
        description: Amount of memory (in GB) assigned to the VM.
      - name: disk
        kind: Number
        optional: true
        order_weight: 1900
        description: Disk space (in GB) assigned to the VM.
    relationships:
      - name: host
        peer: VirtualizationHostVirtualMachine
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1500
