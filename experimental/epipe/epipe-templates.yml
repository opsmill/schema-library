---
# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json

version: "1.0"
nodes:
  - name: LSPTemplate
    label: LSP Template
    include_in_menu: false
    namespace: Infra
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{ role__value }}"
        read_only: true
        optional: false
      - name: role
        kind: Dropdown
        choices:
          - name: low_latency
            label: Low Latency
          - name: igp_cost
            label: IGP Cost
          - name: disjoint
            label: Disjoint
    relationships:
      - name: node_a
        label: Node A
        peer: InfraDevice
        kind: Attribute
        cardinality: one
        identifier: lsptemplate__node_a
      - name: node_b
        label: Node B
        peer: InfraDevice
        kind: Attribute
        cardinality: one
        identifier: lsptemplate__node_b

  - name: EpipeTemplate
    label: Epipe Template
    include_in_menu: false
    namespace: Infra
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: TransformPython
          transform: compute_epipe_name
        read_only: true
        optional: true
      - name: mtu
        kind: Number
        optional: false
        default_value: 9100
        description: "Maximum Transmission Unit"
    relationships:
      - name: customer
        label: Customer
        peer: ServicesCustomer
        kind: Attribute
        cardinality: one
        identifier: epipetemplate__customer
      - name: sdp_a
        label: SDP Node A
        peer: InfraSDP
        kind: Attribute
        cardinality: one
        identifier: epipetemplate__sdp_a
      - name: sdp_b
        label: SDP Node B
        peer: InfraSDP
        kind: Attribute
        cardinality: one
        identifier: epipetemplate__sdp_b
      - name: port_a
        label: Port Node A
        peer: InfraPort
        kind: Attribute
        cardinality: one
        identifier: epipetemplate__port_a
      - name: port_b
        label: Port Node B
        peer: InfraPort
        kind: Attribute
        cardinality: one
        identifier: epipetemplate__port_b

  - name: EpipeService
    label: Epipe Service
    include_in_menu: false
    namespace: Infra
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
        unique: true
        optional: false
    relationships:
      - name: epipe_a
        label: Epipe A-Side
        peer: InfraEpipe
        kind: Component
        cardinality: one
        optional: false
        identifier: epipeservice__epipe_a
      - name: epipe_z
        label: Epipe Z-Side
        peer: InfraEpipe
        kind: Component
        cardinality: one
        optional: false
        identifier: epipeservice__epipe_z
      - name: customer
        label: Customer
        peer: ServicesCustomer
        kind: Attribute
        cardinality: one
        optional: false
        identifier: epipeservice__customer
